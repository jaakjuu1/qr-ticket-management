(this["webpackJsonpqr-ticket-manager-frontend"]=this["webpackJsonpqr-ticket-manager-frontend"]||[]).push([[0],{32:function(e,t,c){},58:function(e,t,c){"use strict";c.r(t);var s=c(1),a=c.n(s),n=c(25),r=c.n(n),i=(c(32),c(4)),l=c(2),o=c(0);var j=function(){return Object(o.jsx)("div",{children:Object(o.jsx)("h1",{children:"Welcome to QR Ticket Manager"})})},d=c(26);const b=c.n(d).a.create({baseURL:"http://localhost:3000/api",headers:{"Content-Type":"application/json"}});b.interceptors.request.use((e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e}),(e=>Promise.reject(e)));var h=function(){const[e,t]=Object(s.useState)(""),[c,a]=Object(s.useState)(""),[n,r]=Object(s.useState)(""),i=Object(l.g)();return Object(s.useEffect)((()=>{localStorage.getItem("token")&&i.push("/dashboard")}),[i]),Object(o.jsxs)("div",{className:"max-w-md mx-auto",children:[Object(o.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Login"}),n&&Object(o.jsx)("p",{className:"text-red-500 mb-4",children:n}),Object(o.jsxs)("form",{onSubmit:async t=>{t.preventDefault();try{const t=await((e,t)=>b.post("/auth/login",{username:e,password:t}))(e,c);localStorage.setItem("token",t.data.token),i.push("/dashboard")}catch(s){r("Invalid username or password")}},className:"space-y-4",children:[Object(o.jsxs)("div",{children:[Object(o.jsx)("label",{className:"block mb-1",children:"Username:"}),Object(o.jsx)("input",{type:"text",value:e,onChange:e=>t(e.target.value),required:!0,className:"w-full px-3 py-2 border rounded"})]}),Object(o.jsxs)("div",{children:[Object(o.jsx)("label",{className:"block mb-1",children:"Password:"}),Object(o.jsx)("input",{type:"password",value:c,onChange:e=>a(e.target.value),required:!0,className:"w-full px-3 py-2 border rounded"})]}),Object(o.jsx)("button",{type:"submit",className:"w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600",children:"Login"})]})]})};var u=function(){const[e,t]=Object(s.useState)(""),[c,a]=Object(s.useState)(""),[n,r]=Object(s.useState)("basic"),[i,j]=Object(s.useState)(""),d=Object(l.g)();return Object(o.jsxs)("div",{children:[Object(o.jsx)("h2",{children:"Register"}),i&&Object(o.jsx)("p",{style:{color:"red"},children:i}),Object(o.jsxs)("form",{onSubmit:async t=>{t.preventDefault();try{await((e,t,c)=>b.post("/auth/register",{username:e,password:t,role:c}))(e,c,n),d.push("/login")}catch(s){console.log(s),j("Registration failed. Please try again.")}},children:[Object(o.jsxs)("div",{children:[Object(o.jsx)("label",{children:"Username:"}),Object(o.jsx)("input",{type:"text",value:e,onChange:e=>t(e.target.value),required:!0})]}),Object(o.jsxs)("div",{children:[Object(o.jsx)("label",{children:"Password:"}),Object(o.jsx)("input",{type:"password",value:c,onChange:e=>a(e.target.value),required:!0})]}),Object(o.jsxs)("div",{children:[Object(o.jsx)("label",{children:"Role:"}),Object(o.jsxs)("select",{value:n,onChange:e=>r(e.target.value),children:[Object(o.jsx)("option",{value:"basic",children:"Basic"}),Object(o.jsx)("option",{value:"device_manager",children:"Device Manager"}),Object(o.jsx)("option",{value:"admin",children:"Admin"})]})]}),Object(o.jsx)("button",{type:"submit",children:"Register"})]})]})};var x=function(){const[e,t]=Object(s.useState)([]),[c,a]=Object(s.useState)(""),[n,r]=Object(s.useState)("");Object(s.useEffect)((()=>{i()}),[]);const i=async()=>{try{const e=await b.get("/tickets/my-tickets");t(e.data)}catch(e){r("Failed to fetch tickets")}};return Object(o.jsxs)("div",{children:[Object(o.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Dashboard"}),n&&Object(o.jsx)("p",{className:"text-red-500 mb-4",children:n}),Object(o.jsxs)("div",{className:"mb-8",children:[Object(o.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Purchase Ticket"}),Object(o.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{await(e=>b.post("/tickets/purchase",{deviceId:e}))(c),i(),a("")}catch(t){r("Failed to purchase ticket")}},className:"space-y-4",children:[Object(o.jsxs)("div",{children:[Object(o.jsx)("label",{className:"block mb-1",children:"Device ID:"}),Object(o.jsx)("input",{type:"text",value:c,onChange:e=>a(e.target.value),required:!0,className:"w-full px-3 py-2 border rounded"})]}),Object(o.jsx)("button",{type:"submit",className:"bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600",children:"Purchase Ticket"})]})]}),Object(o.jsxs)("div",{children:[Object(o.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"My Tickets"}),Object(o.jsx)("ul",{className:"space-y-2",children:e.map((e=>Object(o.jsxs)("li",{className:"bg-white p-4 rounded shadow",children:[Object(o.jsxs)("p",{children:["QR Code: ",e.qrCode]}),Object(o.jsxs)("p",{children:["Status: ",Object(o.jsx)("span",{className:"font-semibold "+("active"===e.status?"text-green-500":"text-red-500"),children:e.status})]})]},e.id)))})]})]})};var O=function(){const[e,t]=Object(s.useState)(""),[c,a]=Object(s.useState)("");return Object(o.jsxs)("div",{children:[Object(o.jsx)("h2",{children:"Device Manager"}),Object(o.jsxs)("form",{onSubmit:async c=>{c.preventDefault();try{await(e=>b.post("/tickets/validate",{qrCode:e}))(e),a("Ticket validated successfully"),t("")}catch(s){a("Failed to validate ticket")}},children:[Object(o.jsx)("input",{type:"text",value:e,onChange:e=>t(e.target.value),placeholder:"Enter QR Code",required:!0}),Object(o.jsx)("button",{type:"submit",children:"Validate Ticket"})]}),c&&Object(o.jsx)("p",{children:c})]})};var m=function(){const[e,t]=Object(s.useState)(null),[c,a]=Object(s.useState)([]);Object(s.useEffect)((()=>{n(),r()}),[]);const n=async()=>{try{const e=await b.get("/admin/analytics");t(e.data)}catch(e){console.error("Failed to fetch analytics",e)}},r=async()=>{try{const e=await b.get("/admin/users");a(e.data)}catch(e){console.error("Failed to fetch users",e)}},i=async(e,t)=>{try{await((e,t)=>b.patch(`/admin/users/${e}`,{role:t}))(e,t),r()}catch(c){console.error("Failed to update user role",c)}};return Object(o.jsxs)("div",{children:[Object(o.jsx)("h2",{children:"Admin Panel"}),e&&Object(o.jsxs)("div",{children:[Object(o.jsx)("h3",{children:"Analytics"}),Object(o.jsxs)("p",{children:["Total Users: ",e.totalUsers]}),Object(o.jsxs)("p",{children:["Total Tickets: ",e.totalTickets]}),Object(o.jsxs)("p",{children:["Active Tickets: ",e.activeTickets]})]}),Object(o.jsx)("h3",{children:"User Management"}),Object(o.jsx)("ul",{children:c.map((e=>Object(o.jsxs)("li",{children:[e.username," - Current Role: ",e.role,Object(o.jsxs)("select",{value:e.role,onChange:t=>i(e.id,t.target.value),children:[Object(o.jsx)("option",{value:"basic",children:"Basic"}),Object(o.jsx)("option",{value:"device_manager",children:"Device Manager"}),Object(o.jsx)("option",{value:"admin",children:"Admin"})]})]},e.id)))})]})};var p=function(){return Object(o.jsxs)("div",{children:[Object(o.jsx)("h2",{children:"Unauthorized Access"}),Object(o.jsx)("p",{children:"You do not have permission to view this page."}),Object(o.jsx)(i.b,{to:"/dashboard",children:"Return to Dashboard"})]})},v=c(11);var g=e=>{let{component:t,roles:c,...s}=e;const a=localStorage.getItem("token"),n=!!a;let r=null;if(n){const e=Object(v.a)(a);r=e.role}return Object(o.jsx)(l.b,{...s,render:e=>n?c&&!c.includes(r)?Object(o.jsx)(l.a,{to:"/unauthorized"}):Object(o.jsx)(t,{...e}):Object(o.jsx)(l.a,{to:{pathname:"/login",state:{from:e.location}}})})};var y=()=>{const e=localStorage.getItem("token"),t=!!e;let c=null;if(t){c=Object(v.a)(e).role}return Object(o.jsx)("nav",{className:"bg-blue-600 text-white p-4",children:Object(o.jsxs)("ul",{className:"flex space-x-4",children:[Object(o.jsx)("li",{children:Object(o.jsx)(i.b,{to:"/",className:"hover:text-blue-200",children:"Home"})}),!t&&Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)("li",{children:Object(o.jsx)(i.b,{to:"/login",className:"hover:text-blue-200",children:"Login"})}),Object(o.jsx)("li",{children:Object(o.jsx)(i.b,{to:"/register",className:"hover:text-blue-200",children:"Register"})})]}),t&&Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)("li",{children:Object(o.jsx)(i.b,{to:"/dashboard",className:"hover:text-blue-200",children:"Dashboard"})}),("device_manager"===c||"admin"===c)&&Object(o.jsx)("li",{children:Object(o.jsx)(i.b,{to:"/device-manager",className:"hover:text-blue-200",children:"Device Manager"})}),"admin"===c&&Object(o.jsx)("li",{children:Object(o.jsx)(i.b,{to:"/admin",className:"hover:text-blue-200",children:"Admin Panel"})}),Object(o.jsx)("li",{children:Object(o.jsx)("button",{onClick:()=>{localStorage.removeItem("token"),window.location.href="/login"},className:"hover:text-blue-200",children:"Logout"})})]})]})})};var f=function(){return Object(o.jsx)(i.a,{children:Object(o.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[Object(o.jsx)(y,{}),Object(o.jsx)("div",{className:"container mx-auto px-4 py-8",children:Object(o.jsxs)(l.d,{children:[Object(o.jsx)(l.b,{exact:!0,path:"/",component:j}),Object(o.jsx)(l.b,{path:"/login",component:h}),Object(o.jsx)(l.b,{path:"/register",component:u}),Object(o.jsx)(l.b,{path:"/unauthorized",component:p}),Object(o.jsx)(g,{path:"/dashboard",component:x,roles:["basic","device_manager","admin"]}),Object(o.jsx)(g,{path:"/device-manager",component:O,roles:["device_manager","admin"]}),Object(o.jsx)(g,{path:"/admin",component:m,roles:["admin"]})]})})]})})};r.a.render(Object(o.jsx)(a.a.StrictMode,{children:Object(o.jsx)(f,{})}),document.getElementById("root"))}},[[58,1,2]]]);
//# sourceMappingURL=main.68a1cee3.chunk.js.map